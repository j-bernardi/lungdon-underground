<!DOCTYPE html>
<html>
<head>
    <title>Tube cigarette convertor</title>
</head>
<body>
    <h1>How many cigarettes did I smoke on the tube?</h1>

    <form method="post">
        
        <label for="tube_line_selector">Select an option custom:</label>

        <select id="tube_line_selector" name="tube_line_selector">
            <option value="" disabled {% if not selected_option %}selected{% endif %}>--Please choose a Tube line--</option>
            {% if options %}
                {% for option in options %}
                <option value="{{ option }}" {% if option == selected_option %}selected{% endif %}>
                    {{ option }}
                </option>
                {% endfor %}
            {% endif %}
        </select>

        <hr>

        <label for="station_1_selector">Select the first station:</label>

        <select id="station_1_selector" name="station_1_selector">
            <option value="" disabled {% if not s1_selected_option %}selected{% endif %}>--Choose station 1--</option>
            {% if s1_options %}
                {% for s1_option in s1_options %}
                <option value="{{ s1_option }}" {% if s1_option == s1_selected_option %}selected{% endif %}>
                    {{ s1_option }}
                </option>
                {% endfor %}
            {% endif %}
        </select>

        <label for="station_2_selector">Select the second station:</label>

        <select id="station_2_selector" name="station_2_selector">
            <option value="" disabled {% if not s2_selected_option %}selected{% endif %}>--Choose station 2--</option>
            {% if s2_options %}
                {% for s2_option in s2_options %}
                <option value="{{ s2_option }}" {% if s2_option == s2_selected_option %}selected{% endif %}>
                    {{ s2_option }}
                </option>
                {% endfor %}
            {% endif %}
        </select>

        <hr>
        
        <input type="submit" value="Calculate">

    </form>

    {% if result %}
    {{ result|safe }}
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $("#tube_line_selector").change(function() {
                var selectedLine = $(this).val();
                $.post("/get_stations", {
                    tube_line: selectedLine
                }, function(data) {
                    var stations = data.stations;
                    var station1Selector = $("#station_1_selector");
                    var station2Selector = $("#station_2_selector");

                    station1Selector.empty();
                    station2Selector.empty();

                    $.each(stations, function(index, value) {
                        station1Selector.append($('<option></option>').attr('value', value).text(value));
                        station2Selector.append($('<option></option>').attr('value', value).text(value));
                    });
                });
            });
        });
    </script>
</body>
</html>
